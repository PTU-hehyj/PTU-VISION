# -*- coding: utf-8 -*-
"""YOLO_animal_ver2.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/199jxNR6PW2T69pD0HaXueYbOXizVtVO7
"""

# 여기서부터 실행시키기
# 데이터셋 폴더에 ver7.zip 파일 - https://drive.google.com/drive/folders/13TrTAPzxVSs1Y4ACxhK3Bgh14j3BvLoE?usp=drive_link

!pip install ultralytics
!pip install opencv-python

# 데이터셋 압축풀기
#!unzip -qq /나의_위치/파일명.zip -d /압축_풀_위치/

!unzip -qq /content/ver7.zip -d /content/ver7



from ultralytics import YOLO
import cv2
# from google.colab import drive
# drive.mount('/content/drive')


# Load a model
model = YOLO("yolo11n.pt")  # load a pretrained model (recommended for training)

# Train the model
results = model.train(data="./ver7/data.yaml", epochs=50, batch=16,imgsz=640)

# from google.colab import drive
# drive.mount('/content/drive')

# from google.colab import drive
# drive.mount('/content/drive')

# Commented out IPython magic to ensure Python compatibility.
# 모델 저장
# %cd '/content/drive/MyDrive/AI_Team_project/모델학습/model_result_ver7'
model.export(format="onnx")

# 모델 예측
results = model(
    "./input.jpg"
)

image = results[0].plot()
print(image)

# !pwd

from ultralytics import YOLO
import cv2
from google.colab.patches import cv2_imshow  # Colab용 이미지 출력 함수

# YOLO 모델 로드
model = YOLO("runs/detect/train3/weights/best.onnx")

# 이미지 예측 수행
results = model(["./input002.JPG"])

# 예측 결과 시각화
for idx ,r in enumerate(results):
  image = results[idx].plot()

  # Colab에서 이미지 출력
  cv2_imshow(image)

  # 결과 저장
  cv2.imwrite("output.jpg", image)

from google.colab import drive
drive.mount('/content/drive')

# 학습결과 저장하기 위한 처리

import locale
locale.getpreferredencoding = lambda: "UTF-8"

!pip install transformers==4.28.1

# 모델학습 결과 저장

!zip -r /content/ver7_result.zip /content/runs/